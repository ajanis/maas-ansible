<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/*

Atom One Dark by Daniel Gamage
Original One Dark Syntax theme from https://github.com/atom/one-dark-syntax

base:    #282c34
mono-1:  #abb2bf
mono-2:  #818896
mono-3:  #5c6370
hue-1:   #56b6c2
hue-2:   #61aeee
hue-3:   #c678dd
hue-4:   #98c379
hue-5:   #e06c75
hue-5-2: #be5046
hue-6:   #d19a66
hue-6-2: #e6c07b

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #abb2bf;
  background: #282c34;
}

.hljs-comment,
.hljs-quote {
  color: #5c6370;
  font-style: italic;
}

.hljs-doctag,
.hljs-keyword,
.hljs-formula {
  color: #c678dd;
}

.hljs-section,
.hljs-name,
.hljs-selector-tag,
.hljs-deletion,
.hljs-subst {
  color: #e06c75;
}

.hljs-literal {
  color: #56b6c2;
}

.hljs-string,
.hljs-regexp,
.hljs-addition,
.hljs-attribute,
.hljs-meta-string {
  color: #98c379;
}

.hljs-built_in,
.hljs-class .hljs-title {
  color: #e6c07b;
}

.hljs-attr,
.hljs-variable,
.hljs-template-variable,
.hljs-type,
.hljs-selector-class,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-number {
  color: #d19a66;
}

.hljs-symbol,
.hljs-bullet,
.hljs-link,
.hljs-meta,
.hljs-selector-id,
.hljs-title {
  color: #61aeee;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

.hljs-link {
  text-decoration: underline;
}

</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="maas-spoc-lab">MAAS sPOC Lab</h1>
<ul>
<li><a href="#maas-spoc-lab">MAAS sPOC Lab</a>
<ul>
<li><a href="#maas-infrastructure-as-code">MAAS INFRASTRUCTURE-AS-CODE</a>
<ul>
<li><a href="#maas-ansible">MAAS-Ansible</a></li>
<li><a href="#maas-packer">MAAS-Packer</a></li>
<li><a href="#devcontainer--codespace-code-environment">Devcontainer / Codespace code environment</a></li>
</ul>
</li>
<li><a href="#physical-hardware-inventory">PHYSICAL HARDWARE INVENTORY</a></li>
<li><a href="#maas-deployments">MAAS DEPLOYMENTS</a>
<ul>
<li><a href="#maas-proof-of-concept">MAAS Proof-Of-Concept</a>
<ul>
<li><a href="#poc-ui">PoC UI</a></li>
<li><a href="#poc-metrics">PoC Metrics</a></li>
<li><a href="#poc-vm-host-network">PoC VM Host Network</a></li>
<li><a href="#cisco-c220m6-provisioning-network">Cisco C220M6 Provisioning Network</a></li>
<li><a href="#cisco-c220m6-switch-pair">Cisco C220M6 Switch Pair</a></li>
<li><a href="#poc-vcenter-url">PoC vCenter URL</a></li>
<li><a href="#poc-http-console">PoC HTTP Console</a></li>
</ul>
</li>
<li><a href="#maas-sandbox-environment">MAAS [SANDBOX] Environment</a>
<ul>
<li><a href="#sandbox-ui">[SANDBOX] UI</a></li>
<li><a href="#sandbox-metrics">[SANDBOX] Metrics</a></li>
<li><a href="#sandbox-vm-host-network">[SANDBOX] VM Host Network</a></li>
<li><a href="#dell-r7525-provisioning-network">Dell R7525 Provisioning Network</a></li>
<li><a href="#dell-r7525-switch-pair">Dell R7525 Switch Pair</a></li>
<li><a href="#dell-r7525-dhcp-helper">Dell R7525 DHCP Helper</a></li>
<li><a href="#sandbox-vsphere-url">[SANDBOX] vSphere URL</a></li>
<li><a href="#sandbox-http-console">[SANDBOX] HTTP Console</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#all-in-one-deployment-post-installation-steps">All-in-One Deployment Post-Installation Steps</a></li>
<li><a href="#custom-images">Custom Images</a>
<ul>
<li><a href="#image-layout">Image Layout</a></li>
<li><a href="#default-source">Default Source</a></li>
<li><a href="#maas-image-url-example">MAAS Image URL Example</a></li>
</ul>
</li>
<li><a href="#additional-reading--documentation">Additional Reading / Documentation</a>
<ul>
<li><a href="#maas-specific-glossary-and-useful-terms">MAAS Specific Glossary and Useful Terms</a>
<ul>
<li><a href="#fabrics">Fabrics</a></li>
<li><a href="#availability-zones">Availability Zones</a></li>
<li><a href="#zones">Zones</a></li>
<li><a href="#spaces">Spaces</a></li>
<li><a href="#regions">Regions</a></li>
<li><a href="#controllers">Controllers</a>
<ul>
<li><a href="#region">Region</a></li>
<li><a href="#rack">Rack</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#maas-network-configuration-exports">MAAS Network Configuration Exports</a></li>
</ul>
</li>
</ul>
<h2 id="maas-infrastructure-as-code">MAAS INFRASTRUCTURE-AS-CODE</h2>
<h3 id="maas-ansible">MAAS-Ansible</h3>
<p>An ansible project with Inventory,Vars,Playbooks,Roles,Libraries and Documentation for deploying a custom configured MAAS environment has been included in the repo.</p>
<p>The project includes everything needed to deploy:</p>
<ul>
<li>All-In-One Node</li>
<li>Multiple-RegionD Hosts + HAProxy + EtcD, (n) RackD Hosts, HA PostgreSQL Cluster with Pacemaker</li>
<li>Optional Observability Stack - enables /metrics endpoints for all MaaS services,  Grafana-Agent Metrics and Log collection, Prometheus metrics storage, Loki Log Storage, Grafana Visualization</li>
</ul>
<h3 id="maas-packer">MAAS-Packer</h3>
<p>The MAAS-Packer repository for custom MAAS-compatible image builds has also been included in the repository.</p>
<h3 id="devcontainer--codespace-code-environment">Devcontainer / Codespace code environment</h3>
<p>A devcontainer has been created specifically for this environment, allowing anyone to get up and running almost immediately.</p>
<p>If you have Docker-Desktop and check out the repository locally or into a docker-volume, a container with PyEnv (which will set up the correct python version and activate the environment automatically, then install all python dependencies, linters, formatters, ansible utilities,  helper scripts, and other configurations.  '</p>
<p>You can also open the repository in a Codespace, which will build the identical container remotely for you.</p>
<h2 id="physical-hardware-inventory">PHYSICAL HARDWARE INVENTORY</h2>
<ul>
<li><a href="MAAS%20PoC%20Hardware-Network%20Spreadsheet.pdf">Available Inventory</a></li>
</ul>
<h2 id="maas-deployments">MAAS DEPLOYMENTS</h2>
<h3 id="maas-proof-of-concept">MAAS Proof-Of-Concept</h3>
<h4 id="poc-ui">PoC UI</h4>
<ul>
<li>VM Hostname: <code>maas-poc-reg01</code></li>
<li>VM IP: <code>44.10.4.101/24</code></li>
<li>Dashboard: <code>http://44.10.4.101:5240/MAAS/</code></li>
</ul>
<h4 id="poc-metrics">PoC Metrics</h4>
<ul>
<li>Grafana: <code>http://44.10.4.101:3000</code></li>
</ul>
<h4 id="poc-vm-host-network">PoC VM Host Network</h4>
<ul>
<li>Host IP: <code>44.10.4.101/24</code></li>
<li>VLAN Name: <code>VLAN1175-KMA1-RackN_PXE_Net</code></li>
<li>VLAN ID: <code>1175</code></li>
<li>Subnet: <code>44.10.4.0/24</code></li>
<li>Gateway: <code>44.10.4.1</code></li>
<li>Broadcast: <code>44.10.4.255</code></li>
<li>Upstream DNS: <code> 10.240.64.124</code></li>
<li>Proxy URL: <code>http://proxy4.spoc.charterlab.com:8080</code></li>
</ul>
<h4 id="cisco-c220m6-provisioning-network">Cisco C220M6 Provisioning Network</h4>
<ul>
<li>VLAN ID: <code>77</code></li>
<li>Subnet: <code>172.22.31.144/28</code></li>
<li>Gateway: <code>172.22.31.145</code></li>
<li>Broadcast: <code>172.22.31.159</code></li>
<li>Dynamic Range (MAAS): <code>172.22.31.150-158</code></li>
<li>MAAS Relay: <code>Fabric0 Untagged -&gt; Fabric-77 Untagged</code></li>
</ul>
<h4 id="cisco-c220m6-switch-pair">Cisco C220M6 Switch Pair</h4>
<ul>
<li>
<p>lfs11s3 : <code>10.240.72.173</code></p>
</li>
<li>
<p>lfs12s3 :### Cisco C220M6 DHCP Helper</p>
</li>
<li>
<p>44.10.4.101</p>
</li>
</ul>
<h4 id="poc-vcenter-url">PoC vCenter URL</h4>
<ul>
<li>https://ctecco01-tnsdcvcsa01.cloud.spoc.charterlab.com/ui/app/vm;nav=v/urn:vmomi:VirtualMachine:vm-2045452:e78e7661-7e60-4d6c-9a12-86ebfeaf067e/summary</li>
</ul>
<h4 id="poc-http-console">PoC HTTP Console</h4>
<ul>
<li>https://ctecco01-tnsdcvcsa01.cloud.spoc.charterlab.com/ui/webconsole.html?vmId=vm-2045452&amp;vmName=maas-poc-aio01&amp;numMksConnections=1&amp;serverGuid=e78e7661-7e60-4d6c-9a12-86ebfeaf067e&amp;locale=en-US</li>
</ul>
<h3 id="maas-sandbox-environment">MAAS [SANDBOX] Environment</h3>
<h4 id="sandbox-ui">[SANDBOX] UI</h4>
<ul>
<li>VM Hostname: <code>maas-sandbox-aio01</code></li>
<li>VM IP: <code>44.10.4.200/24</code></li>
<li>Dashboard: <code>http://44.10.4.200:5240/MAAS/</code></li>
</ul>
<h4 id="sandbox-metrics">[SANDBOX] Metrics</h4>
<ul>
<li>Grafana: <code>http://44.10.4.200:3000</code></li>
</ul>
<h4 id="sandbox-vm-host-network">[SANDBOX] VM Host Network</h4>
<ul>
<li>Host IP: <code>44.10.4.200/24</code></li>
<li>VLAN Name: <code>VLAN1175-KMA1-RackN_PXE_Net</code></li>
<li>VLAN ID: <code>1175</code></li>
<li>Subnet: <code>44.10.4.0/24</code></li>
<li>Gateway: <code>44.10.4.1</code></li>
<li>Broadcast: <code>44.10.4.255</code></li>
<li>Upstream DNS: <code>10.240.64.124</code></li>
<li>Proxy URL: <code>http://proxy4.spoc.charterlab.com:8080</code></li>
</ul>
<h4 id="dell-r7525-provisioning-network">Dell R7525 Provisioning Network</h4>
<ul>
<li>VLAN ID: <code>77</code></li>
<li>Subnet: <code> 172.22.34.16/28</code></li>
<li>Gateway: <code>172.22.34.17</code></li>
<li>Broadcast: <code>172.22.34.31</code></li>
<li>Dynamic Range (MAAS): <code>172.22.34.20-30</code></li>
<li>MAAS Relay: <code>Fabric0 Untagged -&gt; Fabric-77 Untagged</code></li>
</ul>
<h4 id="dell-r7525-switch-pair">Dell R7525 Switch Pair</h4>
<ul>
<li>lfs81s1 : <code>10.240.72.198</code></li>
<li>lfs82s1 : <code>10.240.72.199</code></li>
</ul>
<h4 id="dell-r7525-dhcp-helper">Dell R7525 DHCP Helper</h4>
<ul>
<li>44.10.4.200</li>
</ul>
<h4 id="sandbox-vsphere-url">[SANDBOX] vSphere URL</h4>
<ul>
<li>https://ctecco01-tnsdcvcsa01.cloud.spoc.charterlab.com/ui/app/vm;nav=v/urn:vmomi:VirtualMachine:vm-2042902:e78e7661-7e60-4d6c-9a12-86ebfeaf067e/summary</li>
</ul>
<h4 id="sandbox-http-console">[SANDBOX] HTTP Console</h4>
<ul>
<li>https://ctecco01-tnsdcvcsa01.cloud.spoc.charterlab.com/ui/webconsole.html?vmId=vm-2045452&amp;vmName=maas-poc-aio01&amp;numMksConnections=0&amp;serverGuid=e78e7661-7e60-4d6c-9a12-86ebfeaf067e&amp;locale=en-US</li>
</ul>
<h2 id="all-in-one-deployment-post-installation-steps">All-in-One Deployment Post-Installation Steps</h2>
<ul>
<li>
<p>Enable SSH auth keys:
sed -i -E 's/^#(PubKeyAuthentication.+$)/\1/' /etc/ssh/sshd_config
systemctl restart sshd</p>
</li>
<li>
<p>Apt sources:
cat /etc/apt/sources.list.curtin.old &gt;&gt; /etc/apt/sources.list</p>
</li>
<li>
<p>HTTP/S Proxies for apt and env:
curl -f http://http.spoc.charterlab.com/software/bootstrap/proxy.sh &gt;&gt; /etc/environment
curl -f http://http.spoc.charterlab.com/software/bootstrap/apt.conf &gt;&gt; /etc/apt/apt.conf.d/98proxy</p>
</li>
<li>
<p>Resize Partitions:</p>
</li>
</ul>
<pre class="hljs"><code><div>parted --align opt --script /dev/sda resizepart 4 100%
parted /dev/sda print
pvscan
pvresize /dev/sda4
lvresize -L 5GiB /dev/vg_root/lv_tmp
lvresize -L 10GiB /dev/vg_root/lv_opt
lvresize -L 10GiB /dev/vg_root/lv_varlog
lvresize -L 40GiB /dev/vg_root/lv_root
lvresize -l +100%FREE /dev/vg_root/lv_var
resize2fs /dev/vg_root/lv_opt
resize2fs /dev/vg_root/lv_var
resize2fs /dev/vg_root/lv_varlog
resize2fs /dev/vg_root/lv_tmp
resize2fs /dev/vg_root/lv_root
</div></code></pre>
<ul>
<li>Add default route to Netplan:</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment"># This file is generated from information provided by the datasource.  Changes</span>
<span class="hljs-comment"># to it will not persist across an instance reboot.  To disable cloud-init's</span>
<span class="hljs-comment"># network configuration capabilities, write a file</span>
<span class="hljs-comment"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span>
<span class="hljs-comment"># network: {config: disabled}</span>
<span class="hljs-attr">network:</span>
    <span class="hljs-attr">version:</span> <span class="hljs-number">2</span>
    <span class="hljs-attr">ethernets:</span>
        <span class="hljs-attr">eth0:</span>
            <span class="hljs-attr">dhcp6:</span> <span class="hljs-literal">no</span>
            <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">no</span>
            <span class="hljs-attr">addresses:</span>
              <span class="hljs-bullet">-</span> <span class="hljs-string">"44.10.4.200/24"</span>
            <span class="hljs-attr">routes:</span>
              <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span> <span class="hljs-string">default</span>
                <span class="hljs-attr">via:</span> <span class="hljs-number">44.10</span><span class="hljs-number">.4</span><span class="hljs-number">.1</span>
                <span class="hljs-attr">metric:</span> <span class="hljs-number">100</span>
                <span class="hljs-attr">on-link:</span> <span class="hljs-literal">true</span>
            <span class="hljs-attr">nameservers:</span>
                <span class="hljs-attr">addresses:</span>
                  <span class="hljs-bullet">-</span> <span class="hljs-number">10.240</span><span class="hljs-number">.64</span><span class="hljs-number">.124</span>

    <span class="hljs-attr">vlans:</span>
        <span class="hljs-attr">vlan77:</span>
            <span class="hljs-attr">id:</span> <span class="hljs-number">77</span>
            <span class="hljs-attr">dhcp6:</span> <span class="hljs-literal">no</span>
            <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">no</span>
            <span class="hljs-attr">link:</span> <span class="hljs-string">eth0</span>
            <span class="hljs-attr">routes:</span>
              <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span> <span class="hljs-string">default</span>
                <span class="hljs-attr">via:</span> <span class="hljs-number">44.10</span><span class="hljs-number">.4</span><span class="hljs-number">.200</span>
                <span class="hljs-attr">metric:</span> <span class="hljs-number">200</span>
</div></code></pre>
<pre class="hljs"><code><div>netplan generate
netplan apply

apt-get update
systemctl restart systemd-logind
systemctl restart systemd-resolved
</div></code></pre>
<h2 id="custom-images">Custom Images</h2>
<h3 id="image-layout">Image Layout</h3>
<p>A MAAS Image Contains:</p>
<ul>
<li>A bootloader:  which boots the computer to the point that an operating system can be loaded. MAAS currently uses one of three types of bootloaders: open firmware, PXE, and UEFI.</li>
<li>A bootable kernel (aka: vmlinuz)</li>
<li>An initial ramdisk (aka: initrd)</li>
<li>A SquashFS filesystem.</li>
</ul>
<h3 id="default-source">Default Source</h3>
<p>Canonical provides a source stream for Ubuntu and CentOS(7-8) Cloud-Images.
It is configured by default in MAAS</p>
<ul>
<li>http://images.maas.io/ephemeral-v3/candidate</li>
</ul>
<h3 id="maas-image-url-example">MAAS Image URL Example</h3>
<ul>
<li>https://images.maas.io/ephemeral-v3/stable/streams/v1/com.ubuntu.maas:stable:1:bootloader-download.sjson</li>
</ul>
<h2 id="additional-reading--documentation">Additional Reading / Documentation</h2>
<h3 id="maas-specific-glossary-and-useful-terms">MAAS Specific Glossary and Useful Terms</h3>
<ul>
<li>Secure UEFI Boot</li>
<li>PXE Boot instances</li>
<li>Customize slightly</li>
<li>Image cache</li>
<li>Provisioning Scripts</li>
<li>DHCP Snippets</li>
<li>VLANs</li>
<li>Subnets</li>
<li>Customized configuration</li>
<li>Power management / Integration</li>
</ul>
<h4 id="fabrics">Fabrics</h4>
<p>A fabric connects VLANs. If you understand a VLAN, you know that they permit network connections only between specific switch ports or specifically identified ports (“tagged” ports). Consequently, it would be impossible for two VLANs to communicate with each other. A fabric makes these VLAN-to-VLAN connections possible.
Take me on a quick, deep dive on fabrics
We can illustrate a network fabric more easily by rewinding the term to one of its earliest uses: the early phone system. In a telephone switchboard, subscriber lines (customer phone numbers) ran in a grid pattern in the back of the switchboard, but they didn’t touch each other until the operator inserted the plugs of a patch cable to join them. With some “plugboards” (what a switchboard was actually called), an operator could conference multiple lines by adding more patch cords.
These patch cords essentially acted like a VLAN, allowing only the subscribers whose lines were “patched in” to join the conversation.
But the switchboard only covered one exchange, that is, one three-digit phone number prefix. If a subscriber wanted to conference someone from another exchange, there had to be patch from one exchange to another. This was handled by a long-distance operator. Each exchange had a more robust outgoing line, called a “trunk line,” that connected exchanges in some central place. The long-distance operators could bridge trunks in a specific way, involving a local operator in each of the “bridged” exchanges.
By now, you’re probably starting to recognise a lot of network terms, which is completely appropriate. Almost all modern networking technology originated in the telephone system.
Now imagine that you want to conference in six people, two in each of three distant exchanges. Each exchange operator had to patch two numbers and a trunk line. The long-distance operator had to patch three trunks in a specific way that prevented the conversation from going out to all numbers attached to the trunk.
The details of the method aren’t particularly relevant here, but it usually involved a pair of “bridge clips” that connected non-adjacent wire-crossings, with an insulated portion that laid across wires that weren’t meant to be connected. It looked a lot like a little bridge when properly placed.
Think of each of the local exchange conferences as a VLAN; the long-distance operator’s patch cables created what was called a “fabric.” Our use of fabric is exactly the same idea: some number of private “conversations” (connections) connected to each other so that specific people in each “group” can all talk to each other.
You could describe a fabric as a VLAN namespace. It’s a switch or a combination of switches that use trunking to provide access to specific VLANs. MAAS creates a default fabric (‘fabric-0’) for each detected subnet during installation.
The following conceptual diagram shows two fabrics in the same data centre or region, each using distinct VLAN ranges and their associated subnets:</p>
<h4 id="availability-zones">Availability Zones</h4>
<p>Availability zones in MAAS serve as logical partitions that let you group and isolate resources. Think of them as a way to organise your physical and virtual machines for optimal efficiency and fault tolerance.</p>
<h4 id="zones">Zones</h4>
<p>A physical zone, or just zone, is an organisational unit that contains nodes where each node is in one, and only one, zone. Later, while in production, a node can be taken (allocated) from a specific zone (or not from a specific zone). Since zones, by nature, are custom-designed (except for the ‘default’ zone), they provide more flexibility than a similar feature offered by a public cloud service (ex: availability zones).
Some prime examples of zone usage include fault-tolerance, service performance, and power management.
A newly installed MAAS comes with a default zone which contains all nodes unless you create a new zone. You can therefore safely ignore the entire concept if you’re not interested in leveraging zones.
You cannot remove the ‘default’ zone or change its name.</p>
<h4 id="spaces">Spaces</h4>
<p>A space is a logical grouping of subnets that can communicate with one another. Spaces can be arranged to group subnets according to various parameters. One of the most common examples is a DMZ space, which might group subnets presenting a web interface to the public Internet. Behind this DMZ would be specific applications that aren’t allowed to interact directly with the user, but instead must interact with a Web UI in the DMZ space. MAAS does not create a default space during installation.
Spaces facilitate machine allocation for Juju^. See Juju network spaces^ for more details.</p>
<h4 id="regions">Regions</h4>
<p>A region is an organisational unit one level above a zone. It contains all information about all machines running in any possible zones. In particular, the PostgreSQL database runs at this level and maintains state for all these machines.</p>
<h4 id="controllers">Controllers</h4>
<p>There are two types of controllers: a region controller and a rack controller. The region controller deals with operator requests while one or more rack controllers provide the high-bandwidth services to multiple server racks, as typically found in a data centre.</p>
<h5 id="region">Region</h5>
<p>A region controller consists of the following components:</p>
<ul>
<li>REST API server (TCP port 5240)</li>
<li>PostgreSQL database</li>
<li>DNS</li>
<li>caching HTTP proxy</li>
<li>web UI</li>
</ul>
<p>Think of a region controller can as being responsible for a data centre, or a single region. Multiple fabrics are used by MAAS to accommodate subdivisions within a single region, such as multiple floors in a data centre.</p>
<h5 id="rack">Rack</h5>
<p>A rack controller provides the following services:</p>
<ul>
<li>DHCP</li>
<li>TFTP</li>
<li>HTTP (for images)</li>
<li>power management</li>
</ul>
<p>A rack controller is attached to each “fabric”. As the name implies, a typical setup is to have a rack controller in each data centre server rack. The rack controller will cache large items for performance, such as operating system install images, but maintains no independent state other than the credentials required to talk to the region controller.
Both the region controller and the rack controller can be scaled-out as well as made highly available.</p>
<h2 id="maas-network-configuration-exports">MAAS Network Configuration Exports</h2>
<pre class="hljs"><code><div>[
    {
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"44.10.4.0/24"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Default Subnet"</span>,
        <span class="hljs-attr">"vlan"</span>: {
            <span class="hljs-attr">"vid"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
            <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"relay_vlan"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-string">"mrw8bs"</span>,
            <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-number">5001</span>,
            <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-vmware"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
            <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
            <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5001/"</span>
        },
        <span class="hljs-attr">"cidr"</span>: <span class="hljs-string">"44.10.4.0/24"</span>,
        <span class="hljs-attr">"rdns_mode"</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">"gateway_ip"</span>: <span class="hljs-string">"44.10.4.1"</span>,
        <span class="hljs-attr">"dns_servers"</span>: [
            <span class="hljs-string">"44.10.4.200"</span>
        ],
        <span class="hljs-attr">"allow_dns"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"allow_proxy"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"active_discovery"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">"managed"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"disabled_boot_architectures"</span>: [],
        <span class="hljs-attr">"id"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
        <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/subnets/1/"</span>
    },
    {
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"r7525"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-attr">"vlan"</span>: {
            <span class="hljs-attr">"vid"</span>: <span class="hljs-number">77</span>,
            <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
            <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"relay_vlan"</span>: {
                <span class="hljs-attr">"vid"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
                <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"relay_vlan"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-string">"mrw8bs"</span>,
                <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">"id"</span>: <span class="hljs-number">5001</span>,
                <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-vmware"</span>,
                <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
                <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
                <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5001/"</span>
            },
            <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">35</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-number">5055</span>,
            <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-r7525"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
            <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
            <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5055/"</span>
        },
        <span class="hljs-attr">"cidr"</span>: <span class="hljs-string">"172.22.34.16/28"</span>,
        <span class="hljs-attr">"rdns_mode"</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">"gateway_ip"</span>: <span class="hljs-string">"172.22.34.17"</span>,
        <span class="hljs-attr">"dns_servers"</span>: [
            <span class="hljs-string">"44.10.4.200"</span>
        ],
        <span class="hljs-attr">"allow_dns"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"allow_proxy"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"active_discovery"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">"managed"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"disabled_boot_architectures"</span>: [],
        <span class="hljs-attr">"id"</span>: <span class="hljs-number">42</span>,
        <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
        <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/subnets/42/"</span>
    }
]
</div></code></pre>
<pre class="hljs"><code><div>[
    {
        <span class="hljs-attr">"class_type"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"fabric-vmware"</span>,
        <span class="hljs-attr">"vlans"</span>: [
            {
                <span class="hljs-attr">"vid"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
                <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"relay_vlan"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-vmware"</span>,
                <span class="hljs-attr">"id"</span>: <span class="hljs-number">5001</span>,
                <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-string">"mrw8bs"</span>,
                <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
                <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
                <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5001/"</span>
            }
        ],
        <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/fabrics/0/"</span>
    },
    {
        <span class="hljs-attr">"class_type"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-number">35</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"fabric-r7525"</span>,
        <span class="hljs-attr">"vlans"</span>: [
            {
                <span class="hljs-attr">"vid"</span>: <span class="hljs-number">77</span>,
                <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
                <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"relay_vlan"</span>: {
                    <span class="hljs-attr">"vid"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
                    <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
                    <span class="hljs-attr">"relay_vlan"</span>: <span class="hljs-literal">null</span>,
                    <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-vmware"</span>,
                    <span class="hljs-attr">"id"</span>: <span class="hljs-number">5001</span>,
                    <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-string">"mrw8bs"</span>,
                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
                    <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
                    <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
                    <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5001/"</span>
                },
                <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-r7525"</span>,
                <span class="hljs-attr">"id"</span>: <span class="hljs-number">5055</span>,
                <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
                <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">35</span>,
                <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
                <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5055/"</span>
            }
        ],
        <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/fabrics/35/"</span>
    }
]
</div></code></pre>
<pre class="hljs"><code><div>[
    {
        <span class="hljs-attr">"vid"</span>: <span class="hljs-number">77</span>,
        <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
        <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"relay_vlan"</span>: {
            <span class="hljs-attr">"vid"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
            <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"relay_vlan"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-string">"mrw8bs"</span>,
            <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-number">5001</span>,
            <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-vmware"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
            <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
            <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5001/"</span>
        },
        <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">35</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-number">5055</span>,
        <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-r7525"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
        <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
        <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5055/"</span>
    }
]
</div></code></pre>
<pre class="hljs"><code><div>[
    {
        <span class="hljs-attr">"vid"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"mtu"</span>: <span class="hljs-number">1500</span>,
        <span class="hljs-attr">"dhcp_on"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"external_dhcp"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"relay_vlan"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"fabric"</span>: <span class="hljs-string">"fabric-vmware"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-number">5001</span>,
        <span class="hljs-attr">"primary_rack"</span>: <span class="hljs-string">"mrw8bs"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"untagged"</span>,
        <span class="hljs-attr">"fabric_id"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"space"</span>: <span class="hljs-string">"POC"</span>,
        <span class="hljs-attr">"secondary_rack"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"resource_uri"</span>: <span class="hljs-string">"/MAAS/api/2.0/vlans/5001/"</span>
    }
]
</div></code></pre>

</body>
</html>
